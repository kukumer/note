[TOC]
# 课程介绍
朱雷
邮箱：iamzzzz@163.com

教材：谢希仁 

考试：平时成绩（作业or实验）+闭卷笔试

# 绪论
## 定义
1. 计算机（独立的、自主计算能力的设备）
2. 计算机之间的互联互通
3. 文件的传递与交换、协同计算

## 分类
### 网络的大小
1. 个域网（personal area network）

eg. use Bluetooth
> 传输的距离受限

2. 局域网(local area network,LAN)

eg. use bronze reticle
3. 城域网(metropolitan area networks,MAN)

eg. use fiber optic

### 层次的划分
OSI协议标准：Application/Presentation/Session/Transport/Network/Data link/Physical  

TCP/IP协议采用的分层： 
Application/Transport/Internet/Network Access/Physical  

# 物理层
来自于通信系统
## 基本概念
物理层解决如何在连接计算机的传输媒体（媒介）上传输数据比特流，而不是指具体的传输媒体。物理层的主要任务描述为，确认传输媒体的接口的一些特性，即：
- 机械特性：例如接口形状，大小，引线数目
- 电气特性：例如规定的电压范围
- 功能特性：例如规定-5V表示0，+5V表示1
- 过程特性：也称规程特性，规定建立连接时各个相关部件的工作步骤

## 数据通信的基础知识
### 典型的数据通信模型
![image](CBB2B6EAA49741DBA7C786DC26B88B42)

### 数据通信的相关术语
<b>通信的目的是传送消息</b>  
- 数据：运送消息的实体
- 信号：数据的电气的或电磁的表现
- 模拟信号：代表消息的参数的取值是连续的
- 数字信号：代表消息的参数的取值是离散的。
- 码元：在使用时间域的波形表示数字信号时，则代表不同离散数值的基本波形就成为码元。
> 码元是一个包含一定信息量的一个独立存在的单位。码元是信息量的载体。举个例子：我们的2进制数，一个二进制数，是一个码元，它含有1bit信息量，但是对于以四进制码元单位来传递信息，每个码元则含有2bit信息量。这样的时间间隔内的信号称为二进制码元。而这个间隔被称为码元长度。  

### 有关信道的几个基本概念
信道一般表示向一个方向传送信息的媒体。所以我们说平常的通信线路往往包含一条发送信息的信道和一条接受信息的信道。
- 单向通信（单工通信）：只能有一个方向的通信而没有反方向的交互。（计算机通信很少见）
- 双向交替通信（半双工通信）：通信的双方都可以发送信息，但不能双方同时发送（当然也就不能同时接收）   
eg. 小区保安的无线对讲机通信，只能一个人讲。
- 双向同时通信（全双工通信）：通信双方可以同时发送和接收信息。   
eg. 打电话的时候你既可以说，也可以听。

### 基带(baseband)信号和带通信号(band pass)
- 基带信号：来自信源的信号，比如我们说出的话就是基带信号。
- 带通信号：把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一段频率范围内能够通过信道）。
> 由于在近距离范围内基带信号的衰减不大，从而信号内容不会发生变化。因此在传输距离较近时，计算机网络都采用基带传输方式。如从计算机到监视器、打印机等外设的信号就是基带传输。

<b>基带信号调成带通信号：</b>   
![image](EF07E6EE0E984EEE9C293AC6E3EE8ABF)
调频可能导致频率过不去，高频被过滤掉了
> 使用调制解调器来进行基带信号和带通信号的转换

### 常用编码

<b>编码是从一种形式或格式转换为另一种形式的过程。</b>

![1570632454705](D:\picture\1570632454705.png)

前面的编码方式一定得发送方和接收方==同样的时钟==，两者之间的时钟必须微秒甚至纳秒不差。而曼彻斯特编码可以解决这个问题，但是速度慢了，因为相当于要==检验两个编码==。

![1570632473625](D:\picture\1570632473625.png)

![1570632517470](D:\picture\1570632517470.png)




### 信道极限容量与奈氏准则
数据通信存在干扰：  
![image](D2E8DF767A1B461EA5E1861D6D1B37C6)

奈氏准则：
在理想条件下（不存在电磁干扰），为了避免码间串扰，码元的传输速率的上限值。如果信道的频带越宽，也就是能够通过的信号高频分量越多，那么就可以用更高的速率传送码元而不出现码间串扰。

```math
C = 2Blog_2V (b/s)\\
B:带宽为BHz\\
V:信号电平的级数，在二进制中，仅为0、1两级

```
### 信噪比与香农准则
香农用信息论的理论推导出了带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率。只要信息的传速速率低于信道的极限信息传输速率，就一定可以找到某种办法来实现无差错的传输。

信道的极限传输速率C可表示为：
```math
C = Wlog_2(1+S/N) b/s \\
W为信道的带宽（以Hz为单位）\\
S为信道内所传信号的平均功率 \\
N为信道内部的高斯噪声功率 \\ 
S/N表示信噪比
```

![image](A4208E90EF2F415B99C68A78C833F8CF)

## 物理层下的传输媒体
### 导向传输媒体
导向传输媒体中，电磁波沿着固体媒体传播。
- 双绞线
- 同轴电缆
![image](921996D40B8C47A692F4E340517CB1BE)
- 光缆
![image](7D45C191A87A49B99E45BC8420E8000A)

#### 网线
![image](B8E27C485BBD422384A5491A7A92565D)

![image](39DA299541864FA2A58587E403BA8B8E)

> 同类设备相连需要调整线序，但是不同类设备相连一般就不用调整线序。
> 现在设备能自动协商线序，有些用直通线也能通。

### 非导向传播媒体
![image](122D8F9A6E3A41239121D1BB7D79B98A)
无线电传输：无线电波的特性与频率有关。
- 在低频部分FM广播，无线电波能够很好地穿透障碍物，但是随着离开越来越远，能量急剧减少。
- 在高频部分，无线电波倾向于按直线传播，并且受到障碍物的阻挡。在HF和VHF波段，地面波会被地球吸收。然而，到达电离层的波可以被电离层折射回来，再送回到地球上。

微波传输：把所有的能量集中于一小束，从而获得极高的信噪比，但是发射端和接收端的天线必须精准地相互对齐。与低频无线电不同，微波不能很好地穿透建筑物。传播过程中伴随的多径衰弱与天气与频率有关。
> 微波通信被广泛应用于长途电话通信、移动电话、电视转播。卫星通信也属于微波通信。

集线器：它在网络中只起到信号放大和重发的作用，其目的是扩大网络的传输范围，而不具备信号的定向传送能力。它是一个大的冲突域，在某一个时间点只能两台计算机通信，会出现占线的情况。

## 信道复用技术

![1570634464140](D:\picture\1570634464140.png)

频分复用（FDM）：用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。

频分复用留了一个安全带。但是导致安全带区域没有传输数据。FDM，OFDM(正交技术)广泛运用在4G和5G

![1570634491073](D:\picture\1570634491073.png)
![1570634548206](D:\picture\1570634548206.png)
![1570634620087](D:\picture\1570634620087.png)

时分复用(TDM)：
![1570634718985](D:\picture\1570634718985.png)
![1570634737597](D:\picture\1570634737597.png)

![1570634799679](D:\picture\1570634799679.png)

![1570634822134](D:\picture\1570634822134.png)

波分复用（光的频分复用）(WDM)：
![1570634843407](D:\picture\1570634843407.png)
![1570634857940](D:\picture\1570634857940.png)

码分多路复用(CDM)

![1570587954189](D:\picture\1570587954189.png)

原理：每个站被指派一个唯一的mbit 码片序列，如发送比特1，则发送自己的mbit 码片序列。如发送比特0，则发送该码片序列的二进制反码。 每个站分配的码片序列不仅必须==各不相同==，并且还必须互相==正交(orthogonal)。==

> 举个例子：a = (1,1,1,-1,1,-1),b =(-1,-1,1,-1,1,1)，点乘a与b得到0 

正交的性质：

- 任何一个码片向量和该码片向量自己的规格化内积都是1 。
- 一个码片向量和该码片反码的向量的规格化内积值是 –1。 

> 根据正交的性质，我们就可以计算出传输的是什么信息

## 数字传输系统(公共电话交换网络PSTN)

数字传输系统讲的是广域网之间的数据传输，使用的是电话局的搭建好的广域网的网络

#### 本地回路

每个电话客户的电话机与端局之间的双线连接在电话行业中称为本地回路。即进入家庭和公司的模拟双绞线，是我们通常所说的最后一公里。上面运载的是==模拟信号==。

##### 宽带接入技术

ADSL(Asymmetric Digital Subscriber Line)：利用现有普通电话线为家庭、办公室提供宽带数据传输服务的技术。把0~4KHz低端频谱留给传统电话使用，把原来没有被利用的高端频谱留给用户上网使用。
![1570637451278](D:\picture\1570637451278.png)
ADSL使用的是DMT技术，DMT技术采用频分复用的方法，把不同频率分成许多的子信道，其中25个子信道用于上行信道，而249个子信道用于下行信道。

> 上传比下载用的少

![1570637498239](D:\picture\1570637498239.png)

![1570637509891](D:\picture\1570637509891.png)

HFC（光纤同轴混合网）
![1570637556024](D:\picture\1570637556024.png)

FTTx（FTTH/FTTB/FTTC）：光纤到户，直接拉根光纤过来，不用猫（调制解调器）就能上网。

#### 中继线和多路复用

中继线是用以连接交换局的数字光纤，注意的是这个上面走的是数字信号。而“最后一公里”的本地回路走的是==模拟信号==。这里就涉及到了一个数字信号与模拟信号相互转换的问题。 

##### 脉冲编码调制

![1570588329672](D:\picture\1570588329672.png)

##### 多路复用

<b>意义</b>:中继线上同时进行着数以千计，甚至上百万的电话呼叫。这种多个电话共享一根中继线的方式对于实现规模经济很重要，因为在两个电话局中安装和维护高带宽中继线所需要的基本开销和安装并维护一个低带宽中继线所需的费用差不多。



常用的是时分复用(TDM)

![1570639621911](D:\picture\1570639621911.png)

##### SONET/SDH

不同的运营商各有各的光纤TDM系统，所以标准化的需求变得非常迫切。RBOC的研究机构开发了SONET（同步光网络），ITU在SONET的基础上加了ITU建议，即同步数字系列(SDH)。

### 交换局

<b>交换</b>：数据从一条线路转发到哦另一条线路，这个过程称为交换。

#### 电路交换

<b>过程</b>： 电路交换就是计算机终端之间通信时，一方发起呼叫，独占一条物理线路。当交换机完成接续，对方收到发起端的信号，双方即可进行通信。在整个通信过程中双方一直占用该电路。

#### 报文交换

<b>过程</b>：将用户的报文存储在交换机的存储器中。当所需要的输出电路空闲时，再将该报文发向接收交换机或终端，它以“存储—转发”方式在网内传输数据。

#### 分组（数据包）交换

<b>过程</b>： 分组交换是在“存储—转发”基础上发展起来的，兼有电路交换和报文交换的优点。分组交换在线路上采用动态复用技术传送按一定长度分割为许多小段的数据—分组。每个分组标识后，在一条物理线路上采用动态复用的技术，同时传送多个数据分组。把来自用户发端的数据暂存在交换机的存储器内，接着在网内转发。到达接收端，再去掉分组头将各数据字段按顺序重新装配成完整的报文。

#### 电路互换与包互换的比较

![1570641177096](D:\picture\1570641177096.png)

## 基本理论

[傅里叶分析](https://blog.csdn.net/u013921430/article/details/79683853)：一种常用的信号分析法，用于分析信号的谐波组成

信道宽带H：传输时不发生明显衰减的频率范围。带宽是传输介质的一种物理特性，通常与介质的结构、粗细、长度等有关。

信号带宽：信号能量集中的频率范围

带宽受限信号：有时在电路中引入滤波器来限制信道中传输的信号频率以达到某些目的。

## 计算机网络的性能指标
### 时延
传输时延：从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。   

传播时延：电磁波在通信中需要传播一定的距离而花费的时间，通常为光速的2/3

处理时延、排队时延

![1570635463495](D:\picture\1570635463495.png)
### 利用率
信道利用率：指出某信道有百分之几的时间是被利用的（有数据通过），完全空闲的信道的利用率是0，==信道利用率并非越高越好==

网络利用率：全网络的通道利用率的加权平均值。

### 时延与网络利用率的关系
![1570635522742](D:\picture\1570635522742.png)

![1570635538016](C:\Users\82542\Desktop\1570635538016.png)


### 波特率和比特率

波特率表示每秒钟信道传输的码元数称为码元传输速率，简称波特率。比特率表示每秒通过信道比特的位数。两者之间有转换公式：比特率 = $log_2V$ 波特率



# 数据链路层(The Data Link Layer)

数据链路层不关心物理层的事情，关心的是数据的开头、结尾、数据否有问题

## 基本概念

链路：点到点的==物理==线路段，中间没有任何其他的交换结点。一条链路只是一条通路的一个组成部分

数据链路：==除了==物理线路外，还必须有==通信协议==来控制这些数据的传输。若把实现这些协议的==硬件和软件==加到链路，就构成了数据链路。

帧：数据链路层传输的是帧，包括了帧头、帧尾、IP数据报、校验值、物理层地址



## 三个基本问题

1. <b>封装成帧</b>

   封装成帧就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。确定帧的界限，首部和尾部的一个重要的作用就是进行帧定界。

   ![image-20191112201427144](D:\picture\image-20191112201427144.png)

2. <b>透明传输</b>

    透明传输是指不管所传数据是什么样的比特组合，都应当能够在链路上传送。

   当所传数据中的比特组合恰巧与==某一个控制信息完全==一样时，就必须采取适当的措施，使接收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输是透明的。 比如说“突变”出现了终止密码子

   ![image-20191112201822437](D:\picture\image-20191112201822437.png)

   > 使用转义字符的方式解决这个问题

3. <b>差错控制</b>

   数据链路层只负责无差错的接受，不会纠错，只会直接扔掉

   <b>帧检验技术（循环冗余检验CRC）</b>

   ![1571755656664](D:\picture\1571755656664.png)

   

   步骤：

   - 在所要传输的数据后面添加合适个数的0（位数越多则检测方法出错概论越低，取伪的可能性越小），选取除数的位数比加0个数多一位
   - 根据最高位来取商(最高位为1商1，为0商0)，进行异或运算，不进位，得到最后的商和余数，其中余数作为FCS（帧检验序列），将FCS添加到帧中
   - 在本例中接收端会收到101001001（数据+FCS）以及除数1101，使用101001001除以1101，若得到的余数R = 0，则判定这个帧没有差错，就接收，若余数R 不等于0，则判断这个帧有差错，就丢弃。

   <b>注意：莫混淆了CRC和FCS</b>

   - CRC是一种常用的检错方法，而FCS是添加在数据后面的冗余码。
   - FCS可以用CRC这种方法得出，但CRC并非用来获得FCS的唯一方法。

   <b>特点</b>

   - 这种检测方法并==0不能确定究竟是哪一个或哪几个比特==出现了差错。
   - 只要经过严格的挑选，并使用==位数足够多的除数P==，那么出现检测不到的差错的概念就很小很小。

## 数据链路层的信道类型

### 点到点通信

这种通信使用一对一的点对点通信方式				

![1571758323986](D:\picture\1571758323986.png)

点对点通信数据链路层使用的是PPP协议（包括了封装成帧、透明传输、差错检验）

PPP协议包括<b>三个组成部分</b>：

1. 数据链路层协议可以用于异步串行或同步串行介质
2. 它使用LCP（链路控制协议）建立并维护数据链路连接
3. 网络控制协议（NCP）允许在点到点连接上使用多种网络层协议

![image-20191113080626957](D:\picture\image-20191113080626957.png)

PPP协议帧格式：
![image-20191113081102132](D:\picture\image-20191113081102132.png)

> 因为是点到点的传输，所以地址字段A基本上没什么意义，控制字段C是用来指明信息部分是什么内容、哪种内容

字节填充（透明传输）：

![image-20191113081534310](D:\picture\image-20191113081534310.png)

> 转义的方式似乎是前面加个0x7D，后面的16进制的高位减2，相当于减少了16

零比特填充方法：

PPP协议用在SONET/SDH链路时，使用的是同步传输（一连串比特连续传送）。这时PPP协议采用零比特填充方法来实现透明传输，即在发送端，只要发现5个连续的1，则立即填入一个0.接收端对帧中的比特流进行扫描。每当发现5个连续1时，就把这5个连续1后的一个0删除。 

### 局域网（广播信道）

这种信道使用一对多的广播通信方式。使用专用的共享信道协议来协调这些主机的数据发送。通过地址识别的方式进行了一对一的通信。比如说总线型和集线器类型的。

<b>局域网拓扑结构</b>

组网基本上使用的是星形结构

![image-20191113090311663](D:\picture\image-20191113090311663.png)



这种信道使用一对多的广播通信方式。使用专用的共享信道协议来协调这些主机的数据发送。

#### CSMA/CD协议

CSMA/CD(Carrier Sense Multiple Access with Collision Detection)

复用问题 ：物理层一般来说都属于静态复用，是固定下来的，但是静态复用技术效率比较低，可以看看时分复用造成的浪费，其他的静态复用技术也是存在浪费的问题。

<b>多点接入</b>：表示许多计算机以多点接入的方式连接在一根总线上

<b>载波监听</b>：是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞

<b>碰撞检测</b>：计算机边发送数据边检测信道上的==信号电压大小==。当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加），当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。

<b>碰撞发生后</b>：在发生碰撞时，总线上传输的信号发生了严重的失真，无法从中恢复出有用的信息来。每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送。

<b>争用期</b>：最先发送数据帧的站，在发送数据帧后至多经过时间2$\tau$(两倍的端到端往返时延)就可知道发送的数据帧是否遭受了碰撞。经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。

<b>最短有效帧长</b>：对于10mb/s以太网，在争用期内可以发送512bit，即64字节。以太网规定了最短有效帧长为64字节，凡长度小于64字节的帧都是由于冲突而异常中止的无效帧。

![1571801060739](D:\picture\1571801060739.png)

>  传播时延对载波监听的影响 -> 冲突检测时间>=2$\tau$ ，因为每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。

<b>重要特性</b>：

使用CSMA/CD协议的以太网==不能进行全双工通信而只能进行双向交替通信（半双工）==，这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率。

#### 冲突解决

<b>纯ALOHA：</b>任何用户有数据发送就可以发送，每个用户通过监听信道判断是否发生了冲突，一旦发生了冲突，随机等待一段时间后重新发送。

 **二进制指数类型退避算法**： 

1. 确定基本退避时间，一般是取为争用期2$\tau$。
2. 确定参数k，k = Min[重传次数，10]
3. 从整数集合[0,1,...,($2^k-1$)]中随机地取出一个数，记为r。重传所需的时延就是r倍的基本退避时间。
4. 当重传次数16次仍不能成功即丢弃该帧，并向高层报告。

<b>1-坚持CSMA</b>：信道空闲就发送数据

<b>非坚持CSMA</b>：先监听信道，若信道忙则放弃监听，等待一个随机时间再监听，若信道空闲则发送数据。

>  信道利用率高于1-坚持CSMA，但延迟特性更差一些

<b>P-坚持CSMA</b>：适用于时分信道，站点先监听，信道忙则等到下一个时间片再监听，信道空闲则以概率p发送数据，以概率1-p将发送推迟到下一个时间片。



分槽（分隙）

- MAC地址（物理地址）：MAC地址长6个字节，一般用由冒号分隔的6个十六进制数表示，如8:0:2b:e4:b1:2

全局地址和局部地址

- 局部地址：地址次高比特为1，由网管分配且只在本网内有效
- 全局地址：地址次高比特为0，由IEEE统一分配



## 以太局域网（以太网）

<b>以太网标准</b>：DIX EthernetV2和IEE的802.3标准，但是这两个标准只有很小的差别，严格来说，“以太网”应当是指符合DIX Ethernet V2标准的局域网，但是我们也可以说802.3的局域网简称为“以太网”

> 一般我们说带CSMA/CD协议的就是以太网

为了使数据链路层能更好适应多种局域网标准，802委员会就将局域网的数据链路层拆成两个子层：

- 逻辑链路控制(LLC)子层
- 媒体接入控制(MAC)子层

> 很多适配器上就仅装有MAC协议而没有LLC协议

<b>以太网提供的服务</b>：以太网提供的服务是==不可靠的交付==，即尽最大的努力交付。当接收站收到有差错的数据帧就丢弃此帧（这里与数字链路层是一致的），其他什么也不做。差错的纠正由高层来决定。

<b>以太网的拓扑结构</b>：使用集线器构成的星型结构。

![image-20191113111934386](D:\picture\image-20191113111934386.png)

> 使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是CSMA/CD协议，并共享逻辑上的总线。集线器很像一个多接口的转发器，工作在物理层。带宽是共享的，很容易的被抓包。

<b>以太网的信道利用率</b>：

- 参数a:要提高以太网的信道利用率，就必须减小$\tau$与$T_0$（数据帧发送的时间，有点像火车过山洞）之比。

​									$a = \frac{\tau}{T_0}$ 

​	a越小，表示一发生碰撞就可以检测出来，并立即停止发送，因	而信道利用率很高。a越大，表明争用期所占的比例增大，每发	生一次碰撞就浪费许多信道资源，使得信道利用率明显降低。

​	因此，当数据率一定时，以太网的连线的长度受到限制，否则		$\tau$的数值会太大，以太网的帧长不能太短。否则$T_0$的值会太		小，使a	值太大。

- 信道利用率最大值：发送一帧占用线路的时间是$T_0+\tau$，而帧本身的发送时间是$T_0$。于是我们可计算出理想情况下的极限信道利用率$S_{max}$为：

​									$S_{max} = \frac{T_0}{T_0+\tau}$

> 信道利用率最大值





1<0M以太网

100M以太网

1G以太网



帧：

10M带宽换成百兆带宽，导致传输时间变短，DC效果被削弱，发生冲突的可能性上升



载荷扩充：

效率受限

短帧突发

如何根本解决这些问题



 网桥： 

不同局域网之间的数据交换

交换表

学习性网桥（透明网桥）

环路产生->不断绕圈圈-->网络资源白白浪费->生成树算法









帧：